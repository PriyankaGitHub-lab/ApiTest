from bs4 import BeautifulSoup
import  requests,json,re
headers={'content-type':'application/x-www-form-urlencoded',
         'Cookie':'idsrv.xsrf=LNy20Dcdrb6BtF9GsxKctXLbJmv2karNWjEMN_G1fa8hM_Jw9DA-M9BdtqCG7-zetrq9HM_51MWn6De_vyZLqsfSVggfn1ngbKJ6jsPtoAY; '
                  'SignInMessage.b30a16da14fd128b3fdf0cf41af4749c=pYjMibW8b-BKZZQkDtTQyvsQtwBWH4eoXZkCe2xvzacD0v4Stz-uE7nBJPw4D84J1eT1NZTpaMFx2Kd-d-hvc4my21ZWrL0Oux2XPFwVB0fRSr5t2pxWm5IN9ymi1OhAw4WPxUqmkxc_GED-MPk52fZNjC7RvFVyObt7veRDsX4_3g8tN7ZHs5eEqrjRLtXbYH3ihNudHRLBkw0lwlGXmNNFv5S81mtHd57M_7ls7WKjhtgPVSKFTCaRlYcP3udgWwQmJ9-GK1qh6DPvlsgqBO1YoE-Btpnxw4nwP5Tc2IDIQfmGVg2oK47AUK4DuHM6ykJZyo9n6hDQmMaVXEiZ6nuYuCMLb9ZgrtdGvTvaG7-G5ytpvzAHt05oKj3gTmfFDh_QhdHMVqLOERsjQdJT-ecme28A2-kKMw7J7JkHj7bOHEE9i2RwivY4sNtTGRRPmkaO0ypP0m27LELz9-LBFfLhoM7ATCI27xbRiAg5AvO0trJjVNLIKp50tMnWkxi0Fb0936TOObpFGKkF6pvQVbPXiU66YJN2S6cPhlePIx1B-AbwVGDqBKtFPP-IOhMu8h9kGZ-N81zhGg4PhfB1KnXSiJnWN7tZ588Mf4S-plVYjYBSyWG5cIIOtYy2UX_XDgg3Mb8d6F-JsUEINcjtWATcI6KT8TtNstwodzlqgFQ; SignOutMessage.93a6a8acb3eb86d3be1406d9c11906dc=7kFkRlfRzEmIr6sJYE34v-dHAnq3yOb_smibhMpFO97rjdHzokcbYICXnMkptvilzoI1oOnJmhWo4DSL7gYayN4T_icFRhpwepuE9-OsAR-Fn0o1jga29g8WTfggZUg6IShp1NpCpwYCwiNsp8f0GSduLh1mmnXLaosLWBzwteLYgELqR7ZpEw30jNFEGkzMAYlmaVvFDMAkl6vkW2FftWXLDGgjRktgRiRlcI1SSKs; idsvr.clients=WyJEQUVDMjBBQy05NjI2LTRCMEUtOTRCNS1CNjc0RTI5OEY1MUUiLCIyNzM5M2RlOS04Y2I4LTQ2OGUtODNkZC04YTU1NzAxZThjOWEiXQ; SignInMessage.a23d689cd27ba227f951f509e1186fb4=0hhY99CjzN0xMt7Sv_9TO3ZO4dI0csj4T4Q_tl_mv2jOu9Iy3T38_BKAHyxWy2g01XiNA08bXKkNxqY15AGOhGZsDkxzxTFHMTuOkRt1wJS64sI5aGXalVRY_4KQCpEvV8p3rc607KRwaC_4w8_-LpOtyOWGM1_bUIVctGs33RunE10-l8xr4DF81U9eEdbvlRIwNIjHy8DZ6C73GQxmGCzuKJmN6p3-heopT6yRG1gFCUbyMn3Sk4AVOvDTYsmpW5mMNmF52tsM1ftf-vqmq_V5hzF6epx3LEbjsd27zHHLBnO0B5sOVP8ts546RR_83y9IQI19-LN5ib0lWRThBtF9ZFf4NoNRn5_Csrq43rFoETq9ebyVy2al1_C96uGpLlKkq6AlCGRA6B5Q1RfoXx9UyNni1sodjoXk3vhBGeqFXekywVvefoLQkJFb1K2iMzonkCU5CdKvYFpekueZSuOJnvX2FPL47oCrqMPmtNf1LmIlzOK4kDrZ-HiM2lcT8QoNDeLSUZGUBo4YHg4YQZETRbSs4FTEOOXjvZiktMVuCakxyrZDROypZiziJaF0cwmCY7C9A-4WIiS-ZrvpglR9nBHEBTO4vjIS6wJvwN6fqo7etl_YvaKiQIcHT2Hy34pNzWf4-19LZO3IIdSO1dmpID7RQOy12aoAbO0Eoik; SignInMessage.0cf9e3f343575f84caf0e97dce8580f0=ZFml-jx_2XwJ6ipa71tP0RvdTHvr6y-1_PraUkoiJfNDVJI5UI8sltlr_8A_Oy3QfV26VQRAqCvpe_v1tRK2d7GuWDPvYVEnoUtbKN9iiebQxxFQOpaNOWXq6CD_HCHAuYPEEFkZ0TOLQkyjYPmp-En9J_dzRgydIfqcWuhTc-mM0q3Yr3Xes0dI82kxEFRaM0KezTVmihMkRdCd_xQHiyE-ELIer_G1wGmmWMXL8BXeYBPZu01OI5SyajBSZUPF5Xxgx4prBQ9WdQ58tMmep5z2sO001RUvwOFKIvivHz-RWtvMHoyqxb05sevxRX0wRUvcrdz_xsQvuqxb_SUkpJa5YcGCYtFeOH77qQr-fSWpYn-sJA_A74EdIdmxXBMS08jl4d_kmuMMLv6bGIh3kZtB5bElSnAtISZCsNQAF3CA7Gh0pyOaRYszST5zsmigJR0ONCsNDu_gtqaYT7ncVzR_31Jfxaap5NMJXwoGNZ_c6mIltrGbyXpJnTccnY0a1am3LC09ffmIYT8WNIB8Q5oLcsc9cWvXXuQexgKmBQp4qrp23hIuE63gsAeQIYk1R_1U9Kd543xcsanv2n3gBxGAc1O5KwGLkWsaSnqAjnOVvoV9gw54VmwhPTuCGRWRS4DS49lFBvkPkP4eVI1bJsLk1aZ6nxngA_FvmPGezS8; '
                  'SignInMessage.d1d776cf0e4e7cf5ab94891b1d77ef1a=EfLn6YqogxM5JJR1Mkc-Tz7UkLi5dUf2bUBigVuqDze-_ZAQinOrVg9JzfB5Lc-5Q2A-c2DgUgA0Akm3tHJhLaS7I9ACpD36LWaiXZlMdcZ-HeTWlHG8mrQnwoTzD4XnK8ZiD7sAhYDo7G9MqiRjPrv00KN1wzJCGrBtQegXKS7-jpsDhKgkuKX7iazFS1MU8CuCyCW5UnVs2Xu7c22Ji-YG4nn8--Iw8LzUAZ-z8HiM14ha9XhLRVbKY9lA6phYQfaBw_u0gPzDpMFdOpZAm_sDVld6nLKYGdXtbqiKYN_Mjj8Gh5A8rWTQtZicjT1KFdpq5040PPnPKp50aI1bO5F8CcJnY4jmU8XBCitidL3lvIbzjBCl74wt2Ujmwfo3ef3abiQWfqraEcB3SIJc69gP2hZtyrwN8-W2ne-_LSiH9Yhj4ZC1njIiCC0QNkCeqnX8jd0nn7vX5whPHit8feJcQ89uIN-3oQHybCY4DC4f0TuT6YIim5gYSGUFqUdRi3dEYP4jp3rddW3O5O5lAz_G7L31LmWF9lF1Ni-xyrZmQKx38klveUqhy-g32X82; idsvr.session=b8da51307576da7f522c9307fede9c91; SignInMessage.69bf2cd0b814192c75c93e5fe5be948a=bXNa3BJav7RD587YL5QJhS6YL81VswaKGXNVO461jYg80Iyf8DSTUqYdV4RrC2XQNRSL4HCuI8pZoK8Iwz6Glt9wEbWqRoWRJ8iwRVVLRq-c3rojac4jYTrTzF9ySzSmg4vvI_sIFyueFHfMq376iYRoetOslaBsfmQAATet2iyD_NDwq3PQhuuGwZW5_xPUn0zxH-9uw-LUgTZBt4sPhbQaSlXcUlI-Cqe0SgV2fUYTNcTGIU4C1VYgAWTxhy-fBVU0kjHTz_Ru1xxNULC3MEEXF2HyuLHNJWCj1lOP2RVm98bLBeqYI1VYHVs6SEyFRf5l_7mI8XA5l99DUX_0-EqQIO3kiQ23K--OM6LL4ipohiVj0ddhyd4RBRzsIKU9hEkU-v4Ws3GBAMI1Ja0bCTLPYa-XeTb-88AG11V4uIBYgY2QgW7YF16exomi7nRQUxJoPQib2IG_AYmbhZONOlW-bbrCuXpTs3Hn82ys8F-Rmts9iIzo4hpdYnbmqM_cbMzZ4APLFb3YTGCe4wCWwuyMgoikWsi2kwHkqmhfpo22qmSKNnoK_yd8usPshkIVy8OzagAWRPnGOZtmYiCJkM-baou64UWPiUs2pChmgbZwblSVjJnh8_bfN7Ji81rPEP9UIv-2R4SBanmFxZ137mZH9KT-rZ2XfYH25hTcGsA; _ga=GA1.2.1371015604.1592017082; _gid=GA1.2.1480056367.1592017082; has_js=1; optimizelyEndUserId=oeu1592019742681r0.7984912913730493; optimizelyBuckets=%7B%7D; _vwo_uuid_v2=D8AD2AFE2B6358DFCCB37C312E53FFCAB|6a58036da3da1790415d6f6bbf4bd5e2; _gcl_au=1.1.1232790530.1592019743; _fbp=fb.1.1592019745449.228853162; _cc_id=7454e7f74ed81dc9ef19306481de2800; optimizelySegments=%7B%225962992344%22%3A%22gc%22%2C%226510232419%22%3A%22none%22%2C%225989931341%22%3A%22false%22%2C%225999500045%22%3A%22referral%22%7D; _uetsid=b9bf8b82-878e-90a5-245c-680a23d495c5; '
                  '_uetvid=bef9bb1d-5058-d2e0-0e87-da5393c279dd',
         'Accept':'text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3',
         'authority':'uam1.dexcom.com',
         }
payload={'username':'nilepatest001',
         'password':'Password@1',
         'idsrv.xsrf':'3aeaFmMI4bbUVCv0s5cb52VLp9LAw7sj2__EUu9RbTFI7NFz6IzXSiU7vYE3pcZQC_EKrU9KCh6_k-5R8OcGFwjtI2_rL7RlFD-6LmjRL2U'
         }

url="https://uam1.dexcom.com/identity/login?signin=69bf2cd0b814192c75c93e5fe5be948a"
res=requests.post(url,headers=headers,data=payload).text
soup = BeautifulSoup(res, "html.parser")
access_token_str=soup.find_all(text=re.compile(r'window.ACCESS_TOKEN'))
access_token=access_token_str[0][560:1243]
print("Access_token:",access_token)
analysis_api_endpoint="https://clarity.dexcom.com/api/subject/1594950620847472640/analysis_session"
post_res=requests.post(analysis_api_endpoint,headers={'Accept':'application/json','Access-Token':access_token})
res_content=post_res.content.decode('utf-8')
print(res_content)
analysis_session_id=json.loads(res_content)['analysisSessionId']
analysis_session_id=None
assert (analysis_session_id != None),"analysisSessionId is None"